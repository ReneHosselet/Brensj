var e=require("@gltf-transform/core"),t=require("ktx-parse");function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function u(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}var c=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="InstancedMesh",r.parentTypes=[e.PropertyType.NODE],r.extensionName="EXT_mesh_gpu_instancing",r.attributes=[],r}n(r,t);var o=r.prototype;return o.copy=function(r,n){var o=this;return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this.clearGraphChildList(this.attributes),r.listSemantics().forEach(function(e){o.setAttribute(e,n(r.getAttribute(e)))}),this},o.getAttribute=function(e){var t=this.attributes.find(function(t){return t.semantic===e});return t?t.getChild():null},o.setAttribute=function(e,t){var r=this.getAttribute(e);if(r&&this.removeGraphChild(this.attributes,r),!t)return this;var n=this.graph.linkAttribute(e.toLowerCase(),this,t);return n.semantic=e,this.addGraphChild(this.attributes,n)},o.listAttributes=function(){return this.attributes.map(function(e){return e.getChild()})},o.listSemantics=function(){return this.attributes.map(function(e){return e.semantic})},r}(e.ExtensionProperty);c.EXTENSION_NAME="EXT_mesh_gpu_instancing",u([e.GraphChildList],c.prototype,"attributes",void 0);var l,h,f,p="EXT_mesh_gpu_instancing",x=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).extensionName=p,r.provideTypes=[e.PropertyType.NODE],r.prewriteTypes=[e.PropertyType.ACCESSOR],r}n(r,t);var o=r.prototype;return o.createInstancedMesh=function(){return new c(this.doc.getGraph(),this)},o.read=function(e){var t=this;return(e.jsonDoc.json.nodes||[]).forEach(function(r,n){if(r.extensions&&r.extensions[p]){var o=r.extensions[p],s=t.createInstancedMesh();for(var i in o.attributes)s.setAttribute(i,e.accessors[o.attributes[i]]);e.nodes[n].setExtension(p,s)}}),this},o.prewrite=function(e){e.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(var t,r=a(this.properties);!(t=r()).done;)for(var n,o=a(t.value.listAttributes());!(n=o()).done;)e.addAccessorToUsageGroup(n.value,"INSTANCE_ATTRIBUTE");return this},o.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listNodes().forEach(function(r){var n=r.getExtension(p);if(n){var o=e.nodeIndexMap.get(r),s=t.json.nodes[o],i={attributes:{}};n.listSemantics().forEach(function(t){var r=n.getAttribute(t);i.attributes[t]=e.accessorIndexMap.get(r)}),s.extensions=s.extensions||{},s.extensions[p]=i}}),this},r}(e.Extension);function T(t,r,n,o){var s=t.getArray(),i=s.byteLength/t.getCount();return n===h.ATTRIBUTES&&o!==f.NONE?o===f.EXPONENTIAL?(i=4*t.getElementSize(),s=r.encodeFilterExp(new Float32Array(s),t.getCount(),i,12)):o===f.OCTAHEDRAL?(i=8,s=r.encodeFilterOct(new Float32Array(s),t.getCount(),i,8)):o===f.QUATERNION&&(i=8,s=r.encodeFilterQuat(new Float32Array(s),t.getCount(),i,16)):n===h.ATTRIBUTES&&i%4&&(i=(s=function(t,r){for(var n=e.BufferUtils.padNumber(t.BYTES_PER_ELEMENT*r)/t.BYTES_PER_ELEMENT,o=new t.constructor(t.length/r*n),s=0;s*r<t.length;s++)for(var i=0;i<r;i++)o[s*n+i]=t[s*r+i];return o}(s,t.getElementSize())).byteLength/t.getCount()),{array:s,byteStride:i}}function d(t,r){return r===e.WriterContext.BufferViewUsage.ELEMENT_ARRAY_BUFFER?t.listParents().some(function(t){return t instanceof e.Primitive&&t.getMode()===e.Primitive.Mode.TRIANGLES})?h.TRIANGLES:h.INDICES:h.ATTRIBUTES}function g(e,t){for(var r,n=a(t.getGraph().listParentLinks(e).map(function(e){return e.getName()}).filter(function(e){return"accessor"!==e}));!(r=n()).done;){var o=r.value;if("NORMAL"===o)return f.NONE;if("TANGENT"===o)return f.OCTAHEDRAL;if(o.startsWith("JOINTS_"))return f.NONE;if(o.startsWith("WEIGHTS_"))return f.NONE;if("output"===o){var s=v(e);return"rotation"===s?f.NONE:"translation"===s||"scale"===s?f.EXPONENTIAL:f.NONE}if("input"===o)return f.NONE;if("inverseBindMatrices"===o)return f.NONE}return f.EXPONENTIAL}function v(t){for(var r,n=a(t.listParents());!(r=n()).done;){var o=r.value;if(o instanceof e.AnimationSampler)for(var s,i=a(o.listParents());!(s=i()).done;){var u=s.value;if(u instanceof e.AnimationChannel)return u.getTargetPath()}}return null}x.EXTENSION_NAME=p,function(e){e.QUANTIZE="quantize",e.FILTER="filter"}(l||(l={})),function(e){e.ATTRIBUTES="ATTRIBUTES",e.TRIANGLES="TRIANGLES",e.INDICES="INDICES"}(h||(h={})),function(e){e.NONE="NONE",e.OCTAHEDRAL="OCTAHEDRAL",e.QUATERNION="QUATERNION",e.EXPONENTIAL="EXPONENTIAL"}(f||(f={}));var y="EXT_meshopt_compression",m={method:l.QUANTIZE},E=function(t){function o(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).extensionName=y,r.prereadTypes=[e.PropertyType.BUFFER,e.PropertyType.PRIMITIVE],r.prewriteTypes=[e.PropertyType.BUFFER,e.PropertyType.ACCESSOR],r.readDependencies=["meshopt.decoder"],r.writeDependencies=["meshopt.encoder"],r._decoder=null,r._decoderFallbackBufferMap=new Map,r._encoder=null,r._encoderOptions=m,r._encoderFallbackBuffer=null,r._encoderBufferViews={},r._encoderBufferViewData={},r._encoderBufferViewAccessors={},r}n(o,t);var s=o.prototype;return s.install=function(e,t){return"meshopt.decoder"===e&&(this._decoder=t),"meshopt.encoder"===e&&(this._encoder=t),this},s.setEncoderOptions=function(e){return this._encoderOptions=r({},m,e),this},s.preread=function(t,r){if(!this._decoder){if(!this.isRequired())return this;throw new Error("["+y+'] Please install extension dependency, "meshopt.decoder".')}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error("["+y+"]: Missing WASM support.")}return r===e.PropertyType.BUFFER?this._prereadBuffers(t):r===e.PropertyType.PRIMITIVE&&this._prereadPrimitives(t),this},s._prereadBuffers=function(t){var r=this,n=t.jsonDoc;(n.json.bufferViews||[]).forEach(function(o,s){if(o.extensions&&o.extensions[y]){var i=o.extensions[y],a=i.byteOffset||0,u=i.byteLength||0,c=i.count,l=i.byteStride,h=new Uint8Array(new ArrayBuffer(c*l)),f=n.json.buffers[o.buffer],p=new Uint8Array(f.uri?n.resources[f.uri]:n.resources[e.GLB_BUFFER],a,u);r._decoder.decodeGltfBuffer(h,c,l,p,i.mode,i.filter),t.bufferViews[s]=h}})},s._prereadPrimitives=function(e){var t=this,r=e.jsonDoc;(r.json.bufferViews||[]).forEach(function(n){var o;n.extensions&&n.extensions[y]&&(o=r.json.buffers[n.buffer]).extensions&&o.extensions.EXT_meshopt_compression&&o.extensions.EXT_meshopt_compression.fallback&&t._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[y].buffer])})},s.read=function(t){if(!this.isRequired())return this;for(var r,n=a(this._decoderFallbackBufferMap);!(r=n()).done;){for(var o,s=r.value,i=s[0],u=s[1],c=a(i.listParents());!(o=c()).done;){var l=o.value;l instanceof e.Accessor&&l.swap(i,u)}i.dispose()}return this},s.prewrite=function(t,r){return r===e.PropertyType.ACCESSOR?this._prewriteAccessors(t):r===e.PropertyType.BUFFER&&this._prewriteBuffers(t),this},s._prewriteAccessors=function(t){var r=t.jsonDoc.json,n=this._encoder,o=this._encoderOptions,s=this.doc.createBuffer(),i=this.doc.getRoot().listBuffers().indexOf(s);this._encoderFallbackBuffer=s,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(var u,c=a(this.doc.getRoot().listAccessors());!(u=c()).done;){var h=u.value,p=t.getAccessorUsage(h),x=d(h,p),m=o.method===l.FILTER?g(h,this.doc):f.NONE,E=T(h,n,x,m),C=E.array,_=E.byteStride;if("weights"!==v(h)){var I=h.getBuffer();if(!I)throw new Error(y+": Missing buffer for accessor.");var N,A=this.doc.getRoot().listBuffers().indexOf(I),R=[p,x,m,_,A].join(":"),S=this._encoderBufferViews[R],w=this._encoderBufferViewData[R],M=this._encoderBufferViewAccessors[R];S&&w||(M=this._encoderBufferViewAccessors[R]=[],w=this._encoderBufferViewData[R]=[],S=this._encoderBufferViews[R]={buffer:i,target:e.WriterContext.USAGE_TO_TARGET[p],byteOffset:0,byteLength:0,byteStride:p===e.WriterContext.BufferViewUsage.ARRAY_BUFFER?_:void 0,extensions:(N={},N[y]={buffer:A,byteOffset:0,byteLength:0,mode:x,filter:m===f.NONE?void 0:m,byteStride:_,count:0},N)});var O=t.createAccessorDef(h);O.byteOffset=S.byteLength,t.accessorIndexMap.set(h,r.accessors.length),r.accessors.push(O),M.push(O),w.push(C.slice().buffer),S.byteLength+=C.byteLength,S.extensions.EXT_meshopt_compression.count+=h.getCount()}}},s._prewriteBuffers=function(t){var r=this._encoder;for(var n in this._encoderBufferViews){var o=this._encoderBufferViews[n],s=this._encoderBufferViewData[n],i=this.doc.getRoot().listBuffers()[o.extensions[y].buffer],a=t.otherBufferViews.get(i)||[],u=o.extensions[y],c=u.count,l=u.byteStride,h=u.mode,f=new Uint8Array(e.BufferUtils.concat(s)),p=r.encodeGltfBuffer(f,c,l,h),x=e.BufferUtils.pad(p.slice().buffer);o.extensions[y].byteLength=p.byteLength,s.length=0,s.push(x),a.push(x),t.otherBufferViews.set(i,a)}},s.write=function(t){var r,n=0;for(var o in this._encoderBufferViews){for(var s,i=this._encoderBufferViews[o],u=t.otherBufferViewsIndexMap.get(this._encoderBufferViewData[o][0]),c=a(this._encoderBufferViewAccessors[o]);!(s=c()).done;)s.value.bufferView=u;var l=t.jsonDoc.json.bufferViews[u],h=l.byteOffset||0;Object.assign(l,i),l.byteOffset=n,l.extensions[y].byteOffset=h,n+=e.BufferUtils.padNumber(i.byteLength)}var f=this._encoderFallbackBuffer,p=t.bufferIndexMap.get(f),x=t.jsonDoc.json.buffers[p];return x.byteLength=n,x.extensions=((r={})[y]={fallback:!0},r),f.dispose(),this},o}(e.Extension);E.EXTENSION_NAME=y,E.EncoderMethod=l;var C="EXT_texture_webp",_=function(){function t(){}var r=t.prototype;return r.getSize=function(t){var r=e.BufferUtils.decodeText(t.slice(0,4)),n=e.BufferUtils.decodeText(t.slice(8,12));if("RIFF"!==r||"WEBP"!==n)return null;for(var o=new DataView(t),s=12;s<t.byteLength;){var i=e.BufferUtils.decodeText(t.slice(s,s+4)),a=o.getUint32(s+4,!0);if("VP8 "===i)return[16383&o.getInt16(s+14,!0),16383&o.getInt16(s+16,!0)];if("VP8L"===i){var u=o.getUint8(s+9),c=o.getUint8(s+10),l=o.getUint8(s+11);return[1+((63&c)<<8|u),1+((15&o.getUint8(s+12))<<10|l<<2|(192&c)>>6)]}s+=8+a+a%2}return null},r.getChannels=function(e){return 4},t}(),I=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).extensionName=C,r.prereadTypes=[e.PropertyType.TEXTURE],r}n(r,t),r.register=function(){e.ImageUtils.registerFormat("image/webp",new _)};var o=r.prototype;return o.preread=function(e){return(e.jsonDoc.json.textures||[]).forEach(function(e){e.extensions&&e.extensions[C]&&(e.source=e.extensions[C].source)}),this},o.read=function(e){return this},o.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listTextures().forEach(function(r){if("image/webp"===r.getMimeType()){var n=e.imageIndexMap.get(r);(t.json.textures||[]).forEach(function(e){e.source===n&&(e.extensions=e.extensions||{},e.extensions[C]={source:e.source},delete e.source)})}}),this},r}(e.Extension);I.EXTENSION_NAME=C;var N,A,R,S,w,M,O,F="KHR_draco_mesh_compression";function D(e,t){var r=new N.DecoderBuffer;try{if(r.Init(t,t.length),e.GetEncodedGeometryType(r)!==N.TRIANGULAR_MESH)throw new Error("["+F+"] Unknown geometry type.");var n=new N.Mesh;if(!e.DecodeBufferToMesh(r,n).ok()||0===n.ptr)throw new Error("["+F+"] Decoding failure.");return n}finally{N.destroy(r)}}function b(e,t){var r,n,o=3*t.num_faces();if(t.num_points()<=65534){var s=o*Uint16Array.BYTES_PER_ELEMENT;r=N._malloc(s),e.GetTrianglesUInt16Array(t,s,r),n=new Uint16Array(N.HEAPU16.buffer,r,o).slice()}else{var i=o*Uint32Array.BYTES_PER_ELEMENT;r=N._malloc(i),e.GetTrianglesUInt32Array(t,i,r),n=new Uint32Array(N.HEAPU32.buffer,r,o).slice()}return N._free(r),n}function G(e,t,r,n){var o=R[n.componentType],s=A[n.componentType],i=r.num_components(),a=t.num_points()*i,u=a*s.BYTES_PER_ELEMENT,c=N._malloc(u);e.GetAttributeDataArrayForAllPoints(t,r,o,u,c);var l=new s(N.HEAPF32.buffer,c,a).slice();return N._free(c),l}!function(e){e[e.EDGEBREAKER=1]="EDGEBREAKER",e[e.SEQUENTIAL=0]="SEQUENTIAL"}(M||(M={})),function(e){e.POSITION="POSITION",e.NORMAL="NORMAL",e.COLOR="COLOR",e.TEX_COORD="TEX_COORD",e.GENERIC="GENERIC"}(O||(O={}));var P=((S={})[O.POSITION]=14,S[O.NORMAL]=10,S[O.COLOR]=8,S[O.TEX_COORD]=12,S[O.GENERIC]=12,S),B={decodeSpeed:5,encodeSpeed:5,method:M.EDGEBREAKER,quantizationBits:P,quantizationVolume:"mesh"};function U(e,t){void 0===t&&(t=B);var n=r({},B,t);n.quantizationBits=r({},P,t.quantizationBits);for(var o,s=new w.Encoder,i=new w.MeshBuilder,u=new w.Mesh,c={},l=new w.DracoInt8Array,h=a(e.listSemantics());!(o=h()).done;){var f=o.value,p=e.getAttribute(f),x=j(f),T=L(i,p.getComponentType(),u,w[x],p.getCount(),p.getElementSize(),p.getArray());if(-1===T)throw new Error('Error compressing "'+f+'" attribute.');if(c[f]=T,"mesh"===n.quantizationVolume||"POSITION"!==f)s.SetAttributeQuantization(w[x],n.quantizationBits[x]);else{if("object"!=typeof n.quantizationVolume)throw new Error("Invalid quantization volume state.");var d=n.quantizationVolume,g=Math.max(d.max[0]-d.min[0],d.max[1]-d.min[1],d.max[2]-d.min[2]);s.SetAttributeExplicitQuantization(w[x],n.quantizationBits[x],p.getElementSize(),d.min,g)}}var v=e.getIndices();if(!v)throw new Error("Primitive must have indices.");i.AddFacesToMesh(u,v.getCount()/3,v.getArray()),s.SetSpeedOptions(n.encodeSpeed,n.decodeSpeed),s.SetTrackEncodedProperties(!0),e.listTargets().length>0||n.method===M.SEQUENTIAL?s.SetEncodingMethod(w.MESH_SEQUENTIAL_ENCODING):s.SetEncodingMethod(w.MESH_EDGEBREAKER_ENCODING);var y=s.EncodeMeshToDracoBuffer(u,l);if(y<=0)throw new Error("Error applying Draco compression.");for(var m=new Uint8Array(y),E=0;E<y;++E)m[E]=l.GetValue(E);var C=s.GetNumberOfEncodedPoints(),_=3*s.GetNumberOfEncodedFaces();return w.destroy(l),w.destroy(u),w.destroy(i),w.destroy(s),{numVertices:C,numIndices:_,data:m,attributeIDs:c}}function j(e){return"POSITION"===e?O.POSITION:"NORMAL"===e?O.NORMAL:e.startsWith("COLOR_")?O.COLOR:e.startsWith("TEXCOORD_")?O.TEX_COORD:O.GENERIC}function L(t,r,n,o,s,i,a){switch(r){case e.Accessor.ComponentType.UNSIGNED_BYTE:return t.AddUInt8Attribute(n,o,s,i,a);case e.Accessor.ComponentType.BYTE:return t.AddInt8Attribute(n,o,s,i,a);case e.Accessor.ComponentType.UNSIGNED_SHORT:return t.AddUInt16Attribute(n,o,s,i,a);case e.Accessor.ComponentType.SHORT:return t.AddInt16Attribute(n,o,s,i,a);case e.Accessor.ComponentType.UNSIGNED_INT:return t.AddUInt32Attribute(n,o,s,i,a);case e.Accessor.ComponentType.FLOAT:return t.AddFloatAttribute(n,o,s,i,a);default:throw new Error('Unexpected component type, "'+r+'".')}}var k="KHR_draco_mesh_compression",H=function(t){function o(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).extensionName=k,r.prereadTypes=[e.PropertyType.PRIMITIVE],r.prewriteTypes=[e.PropertyType.ACCESSOR],r.readDependencies=["draco3d.decoder"],r.writeDependencies=["draco3d.encoder"],r._decoderModule=null,r._encoderModule=null,r._encoderOptions={},r}n(o,t);var s=o.prototype;return s.install=function(t,r){var n,o;return"draco3d.decoder"===t&&(this._decoderModule=r,N=this._decoderModule,(n={})[e.Accessor.ComponentType.FLOAT]=Float32Array,n[e.Accessor.ComponentType.UNSIGNED_INT]=Uint32Array,n[e.Accessor.ComponentType.UNSIGNED_SHORT]=Uint16Array,n[e.Accessor.ComponentType.UNSIGNED_BYTE]=Uint8Array,n[e.Accessor.ComponentType.SHORT]=Int16Array,n[e.Accessor.ComponentType.BYTE]=Int8Array,A=n,(o={})[e.Accessor.ComponentType.FLOAT]=N.DT_FLOAT32,o[e.Accessor.ComponentType.UNSIGNED_INT]=N.DT_UINT32,o[e.Accessor.ComponentType.UNSIGNED_SHORT]=N.DT_UINT16,o[e.Accessor.ComponentType.UNSIGNED_BYTE]=N.DT_UINT8,o[e.Accessor.ComponentType.SHORT]=N.DT_INT16,o[e.Accessor.ComponentType.BYTE]=N.DT_INT8,R=o),"draco3d.encoder"===t&&(this._encoderModule=r,w=this._encoderModule),this},s.setEncoderOptions=function(e){return this._encoderOptions=e,this},s.preread=function(t){if(!this._decoderModule)throw new Error("["+k+'] Please install extension dependency, "draco3d.decoder".');var r=this.doc.getLogger(),n=t.jsonDoc,o=new Map;try{for(var s,i=a(n.json.meshes||[]);!(s=i()).done;)for(var u,c=a(s.value.primitives);!(u=c()).done;){var l=u.value;if(l.extensions&&l.extensions[k]){var h=l.extensions[k],f=o.get(h.bufferView)||[],p=f[0],x=f[1];if(!x||!p){var T=n.json.bufferViews[h.bufferView],d=n.json.buffers[T.buffer],g=new Int8Array(d.uri?n.resources[d.uri]:n.resources[e.GLB_BUFFER],T.byteOffset||0,T.byteLength);x=D(p=new this._decoderModule.Decoder,g),o.set(h.bufferView,[p,x]),r.debug("["+k+"] Decompressed "+g.byteLength+" bytes.")}for(var v in l.attributes){var y=t.jsonDoc.json.accessors[l.attributes[v]],m=p.GetAttributeByUniqueId(x,h.attributes[v]),E=G(p,x,m,y);t.accessors[l.attributes[v]].setArray(E)}void 0!==l.indices&&t.accessors[l.indices].setArray(b(p,x))}}}finally{for(var C=0,_=Array.from(o.values());C<_.length;C++){var I=_[C],N=I[1];this._decoderModule.destroy(I[0]),this._decoderModule.destroy(N)}}return this},s.read=function(e){return this},s.prewrite=function(t,n){if(!this._encoderModule)throw new Error("["+k+'] Please install extension dependency, "draco3d.encoder".');var o=this.doc.getLogger();o.debug("["+k+"] Compression options: "+JSON.stringify(this._encoderOptions));var s=function(t){for(var r,n=t.getLogger(),o=new Set,s=new Set,i=a(t.getRoot().listMeshes());!(r=i()).done;)for(var u,c=a(r.value.listPrimitives());!(u=c()).done;){var l=u.value;l.getIndices()?l.getMode()!==e.Primitive.Mode.TRIANGLES?(s.add(l),n.warn("["+k+"] Skipping Draco compression on non-TRIANGLES primitive.")):o.add(l):(s.add(l),n.warn("["+k+"] Skipping Draco compression on non-indexed primitive."))}for(var h=t.getRoot().listAccessors(),f=new Map,p=0;p<h.length;p++)f.set(h[p],p);for(var x=new Map,T=new Set,d=new Map,g=0,v=Array.from(o);g<v.length;g++){var y=v[g],m=V(y,f);if(T.has(m))d.set(y,m);else{if(x.has(y.getIndices())){var E=y.getIndices(),C=E.clone();f.set(C,t.getRoot().listAccessors().length-1),y.swap(E,C)}for(var _,I=a(y.listAttributes());!(_=I()).done;){var N=_.value;if(x.has(N)){var A=N.clone();f.set(A,t.getRoot().listAccessors().length-1),y.swap(N,A)}}m=V(y,f),T.add(m),d.set(y,m),x.set(y.getIndices(),m);for(var R,S=a(y.listAttributes());!(R=S()).done;)x.set(R.value,m)}}for(var w=0,M=Array.from(x.keys());w<M.length;w++){var O=new Set(M[w].listParents().map(function(e){return e.propertyType}));if(2!==O.size||!O.has("Primitive")||!O.has("Root"))throw new Error("["+k+"] Compressed accessors must only be used as indices or vertex attributes.")}for(var F=function(){var e=b[D],t=d.get(e),r=e.getIndices();if(x.get(r)!==t||e.listAttributes().some(function(e){return x.get(e)!==t}))throw new Error("["+k+"] Draco primitives must share all, or no, accessors.")},D=0,b=Array.from(o);D<b.length;D++)F();for(var G=0,P=Array.from(s);G<P.length;G++){var B=P[G],U=B.getIndices();if(x.has(U)||B.listAttributes().some(function(e){return x.has(e)}))throw new Error("["+k+"] Accessor cannot be shared by compressed and uncompressed primitives.")}return d}(this.doc),i=new Map,u="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.doc.getRoot().listScenes().length?o.warn("["+k+"]: quantizationVolume=scene requires exactly 1 scene."):u=e.bounds(this.doc.getRoot().listScenes().pop()));for(var c=0,l=Array.from(s.keys());c<l.length;c++){var h=l[c],f=s.get(h);if(!f)throw new Error("Unexpected primitive.");if(i.has(f))i.set(f,i.get(f));else{var p=h.getIndices(),x=t.jsonDoc.json.accessors,T=U(h,r({},this._encoderOptions,{quantizationVolume:u}));i.set(f,T);var d=t.createAccessorDef(p);d.count=T.numIndices,t.accessorIndexMap.set(p,x.length),x.push(d);for(var g,v=a(h.listSemantics());!(g=v()).done;){var y=h.getAttribute(g.value),m=t.createAccessorDef(y);m.count=T.numVertices,t.accessorIndexMap.set(y,x.length),x.push(m)}var E=h.getAttribute("POSITION").getBuffer()||this.doc.getRoot().listBuffers()[0];t.otherBufferViews.has(E)||t.otherBufferViews.set(E,[]),t.otherBufferViews.get(E).push(T.data)}}return o.debug("["+k+"] Compressed "+s.size+" primitives."),t.extensionData[k]={primitiveHashMap:s,primitiveEncodingMap:i},this},s.write=function(e){for(var t,r=e.extensionData[k],n=a(this.doc.getRoot().listMeshes());!(t=n()).done;)for(var o=t.value,s=e.jsonDoc.json.meshes[e.meshIndexMap.get(o)],i=0;i<o.listPrimitives().length;i++){var u=o.listPrimitives()[i],c=s.primitives[i],l=r.primitiveHashMap.get(u);if(l){var h=r.primitiveEncodingMap.get(l);c.extensions=c.extensions||{},c.extensions[k]={bufferView:e.otherBufferViewsIndexMap.get(h.data),attributes:h.attributeIDs}}}if(!r.primitiveHashMap.size){var f=e.jsonDoc.json;f.extensionsUsed=(f.extensionsUsed||[]).filter(function(e){return e!==k}),f.extensionsRequired=(f.extensionsRequired||[]).filter(function(e){return e!==k})}return this},o}(e.Extension);function V(e,t){var r=[],n=e.getIndices();r.push(t.get(n));for(var o,s=a(e.listAttributes());!(o=s()).done;)r.push(t.get(o.value));return r.sort().join("|")}H.EXTENSION_NAME=k,H.EncoderMethod=M;var X=function(t){function r(){for(var n,o=arguments.length,s=new Array(o),i=0;i<o;i++)s[i]=arguments[i];return(n=t.call.apply(t,[this].concat(s))||this).propertyType="Light",n.parentTypes=[e.PropertyType.NODE],n.extensionName="KHR_lights_punctual",n._color=[1,1,1],n._intensity=1,n._type=r.Type.POINT,n._range=null,n._innerConeAngle=0,n._outerConeAngle=Math.PI/4,n}n(r,t);var o=r.prototype;return o.copy=function(r,n){return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this._color=[].concat(r._color),this._intensity=r._intensity,this._type=r._type,this._range=r._range,this._innerConeAngle=r._innerConeAngle,this._outerConeAngle=r._outerConeAngle,this},o.getColor=function(){return this._color},o.setColor=function(e){return this._color=e,this},o.getColorHex=function(){return e.ColorUtils.factorToHex(this._color)},o.setColorHex=function(t){return e.ColorUtils.hexToFactor(t,this._color),this},o.getIntensity=function(){return this._intensity},o.setIntensity=function(e){return this._intensity=e,this},o.getType=function(){return this._type},o.setType=function(e){return this._type=e,this},o.getRange=function(){return this._range},o.setRange=function(e){return this._range=e,this},o.getInnerConeAngle=function(){return this._innerConeAngle},o.setInnerConeAngle=function(e){return this._innerConeAngle=e,this},o.getOuterConeAngle=function(){return this._outerConeAngle},o.setOuterConeAngle=function(e){return this._outerConeAngle=e,this},r}(e.ExtensionProperty);X.EXTENSION_NAME="KHR_lights_punctual",X.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};var K="KHR_lights_punctual",Y=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).extensionName=K,e}n(r,t);var o=r.prototype;return o.createLight=function(){return new X(this.doc.getGraph(),this)},o.read=function(e){var t=this,r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[K])return this;var n=(r.json.extensions[K].lights||[]).map(function(e){var r=t.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&r.setColor(e.color),void 0!==e.intensity&&r.setIntensity(e.intensity),void 0!==e.range&&r.setRange(e.range),void 0!==e.innerConeAngle&&r.setInnerConeAngle(e.innerConeAngle),void 0!==e.outerConeAngle&&r.setOuterConeAngle(e.outerConeAngle),r});return r.json.nodes.forEach(function(t,r){t.extensions&&t.extensions[K]&&e.nodes[r].setExtension(K,n[t.extensions[K].light])}),this},o.write=function(t){var r=t.jsonDoc;if(0===this.properties.size)return this;for(var n,o=[],s=new Map,i=a(this.properties);!(n=i()).done;){var u=n.value,c={type:u.getType()};e.MathUtils.eq(u.getColor(),[1,1,1])||(c.color=u.getColor()),1!==u.getIntensity()&&(c.intensity=u.getIntensity()),null!=u.getRange()&&(c.range=u.getRange()),u.getName()&&(c.name=u.getName()),u.getType()===X.Type.SPOT&&(c.innerConeAngle=u.getInnerConeAngle(),c.outerConeAngle=u.getOuterConeAngle()),o.push(c),s.set(u,o.length-1)}return this.doc.getRoot().listNodes().forEach(function(e){var n=e.getExtension(K);if(n){var o=t.nodeIndexMap.get(e),i=r.json.nodes[o];i.extensions=i.extensions||{},i.extensions[K]={light:s.get(n)}}}),r.json.extensions=r.json.extensions||{},r.json.extensions[K]={lights:o},this},r}(e.Extension);Y.EXTENSION_NAME=K;var q=e.TextureChannel.R,z=e.TextureChannel.G,Q=e.TextureChannel.B,W=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="Clearcoat",r.parentTypes=[e.PropertyType.MATERIAL],r.extensionName="KHR_materials_clearcoat",r._clearcoatFactor=0,r._clearcoatRoughnessFactor=0,r._clearcoatNormalScale=1,r.clearcoatTexture=null,r.clearcoatTextureInfo=r.graph.link("clearcoatTextureInfo",s(r),new e.TextureInfo(r.graph)),r.clearcoatRoughnessTexture=null,r.clearcoatRoughnessTextureInfo=r.graph.link("clearcoatRoughnessTextureInfo",s(r),new e.TextureInfo(r.graph)),r.clearcoatNormalTexture=null,r.clearcoatNormalTextureInfo=r.graph.link("clearcoatNormalTextureInfo",s(r),new e.TextureInfo(r.graph)),r}n(r,t);var o=r.prototype;return o.copy=function(r,n){return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this._clearcoatFactor=r._clearcoatFactor,this._clearcoatRoughnessFactor=r._clearcoatRoughnessFactor,this._clearcoatNormalScale=r._clearcoatNormalScale,this.setClearcoatTexture(r.clearcoatTexture?n(r.clearcoatTexture.getChild()):null),this.clearcoatTextureInfo.getChild().copy(n(r.clearcoatTextureInfo.getChild()),n),this.setClearcoatRoughnessTexture(r.clearcoatRoughnessTexture?n(r.clearcoatRoughnessTexture.getChild()):null),this.clearcoatRoughnessTextureInfo.getChild().copy(n(r.clearcoatRoughnessTextureInfo.getChild()),n),this.setClearcoatNormalTexture(r.clearcoatNormalTexture?n(r.clearcoatNormalTexture.getChild()):null),this.clearcoatNormalTextureInfo.getChild().copy(n(r.clearcoatNormalTextureInfo.getChild()),n),this},o.dispose=function(){this.clearcoatTextureInfo.getChild().dispose(),this.clearcoatRoughnessTextureInfo.getChild().dispose(),this.clearcoatNormalTextureInfo.getChild().dispose(),t.prototype.dispose.call(this)},o.getClearcoatFactor=function(){return this._clearcoatFactor},o.setClearcoatFactor=function(e){return this._clearcoatFactor=e,this},o.getClearcoatTexture=function(){return this.clearcoatTexture?this.clearcoatTexture.getChild():null},o.getClearcoatTextureInfo=function(){return this.clearcoatTexture?this.clearcoatTextureInfo.getChild():null},o.setClearcoatTexture=function(e){return this.clearcoatTexture=this.graph.linkTexture("clearcoatTexture",q,this,e),this},o.getClearcoatRoughnessFactor=function(){return this._clearcoatRoughnessFactor},o.setClearcoatRoughnessFactor=function(e){return this._clearcoatRoughnessFactor=e,this},o.getClearcoatRoughnessTexture=function(){return this.clearcoatRoughnessTexture?this.clearcoatRoughnessTexture.getChild():null},o.getClearcoatRoughnessTextureInfo=function(){return this.clearcoatRoughnessTexture?this.clearcoatRoughnessTextureInfo.getChild():null},o.setClearcoatRoughnessTexture=function(e){return this.clearcoatRoughnessTexture=this.graph.linkTexture("clearcoatRoughnessTexture",z,this,e),this},o.getClearcoatNormalScale=function(){return this._clearcoatNormalScale},o.setClearcoatNormalScale=function(e){return this._clearcoatNormalScale=e,this},o.getClearcoatNormalTexture=function(){return this.clearcoatNormalTexture?this.clearcoatNormalTexture.getChild():null},o.getClearcoatNormalTextureInfo=function(){return this.clearcoatNormalTexture?this.clearcoatNormalTextureInfo.getChild():null},o.setClearcoatNormalTexture=function(e){return this.clearcoatNormalTexture=this.graph.linkTexture("clearcoatNormalTexture",q|z|Q,this,e),this},r}(e.ExtensionProperty);W.EXTENSION_NAME="KHR_materials_clearcoat",u([e.GraphChild],W.prototype,"clearcoatTexture",void 0),u([e.GraphChild],W.prototype,"clearcoatTextureInfo",void 0),u([e.GraphChild],W.prototype,"clearcoatRoughnessTexture",void 0),u([e.GraphChild],W.prototype,"clearcoatRoughnessTextureInfo",void 0),u([e.GraphChild],W.prototype,"clearcoatNormalTexture",void 0),u([e.GraphChild],W.prototype,"clearcoatNormalTextureInfo",void 0);var J="KHR_materials_clearcoat",Z=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).extensionName=J,t}n(t,e);var r=t.prototype;return r.createClearcoat=function(){return new W(this.doc.getGraph(),this)},r.read=function(e){var t=this,r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,o){if(r.extensions&&r.extensions[J]){var s=t.createClearcoat();e.materials[o].setExtension(J,s);var i=r.extensions[J];if(void 0!==i.clearcoatFactor&&s.setClearcoatFactor(i.clearcoatFactor),void 0!==i.clearcoatRoughnessFactor&&s.setClearcoatRoughnessFactor(i.clearcoatRoughnessFactor),void 0!==i.clearcoatTexture){var a=i.clearcoatTexture;s.setClearcoatTexture(e.textures[n[a.index].source]),e.setTextureInfo(s.getClearcoatTextureInfo(),a)}if(void 0!==i.clearcoatRoughnessTexture){var u=i.clearcoatRoughnessTexture;s.setClearcoatRoughnessTexture(e.textures[n[u.index].source]),e.setTextureInfo(s.getClearcoatRoughnessTextureInfo(),u)}if(void 0!==i.clearcoatNormalTexture){var c=i.clearcoatNormalTexture;s.setClearcoatNormalTexture(e.textures[n[c.index].source]),e.setTextureInfo(s.getClearcoatNormalTextureInfo(),c),void 0!==c.scale&&s.setClearcoatNormalScale(c.scale)}}}),this},r.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var n=r.getExtension(J);if(n){var o=e.materialIndexMap.get(r),s=t.json.materials[o];s.extensions=s.extensions||{};var i=s.extensions[J]={clearcoatFactor:n.getClearcoatFactor(),clearcoatRoughnessFactor:n.getClearcoatRoughnessFactor()};if(n.getClearcoatTexture()){var a=n.getClearcoatTexture(),u=n.getClearcoatTextureInfo();i.clearcoatTexture=e.createTextureInfoDef(a,u)}if(n.getClearcoatRoughnessTexture()){var c=n.getClearcoatRoughnessTexture(),l=n.getClearcoatRoughnessTextureInfo();i.clearcoatRoughnessTexture=e.createTextureInfoDef(c,l)}if(n.getClearcoatNormalTexture()){var h=n.getClearcoatNormalTexture(),f=n.getClearcoatNormalTextureInfo();i.clearcoatNormalTexture=e.createTextureInfoDef(h,f),1!==n.getClearcoatNormalScale()&&(i.clearcoatNormalTexture.scale=n.getClearcoatNormalScale())}}}),this},t}(e.Extension);Z.EXTENSION_NAME=J;var $=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="IOR",r.parentTypes=[e.PropertyType.MATERIAL],r.extensionName="KHR_materials_ior",r._ior=0,r}n(r,t);var o=r.prototype;return o.copy=function(r,n){return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this._ior=r._ior,this},o.getIOR=function(){return this._ior},o.setIOR=function(e){return this._ior=e,this},r}(e.ExtensionProperty);$.EXTENSION_NAME="KHR_materials_ior";var ee="KHR_materials_ior",te=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).extensionName=ee,t}n(t,e);var r=t.prototype;return r.createIOR=function(){return new $(this.doc.getGraph(),this)},r.read=function(e){var t=this;return(e.jsonDoc.json.materials||[]).forEach(function(r,n){if(r.extensions&&r.extensions[ee]){var o=t.createIOR();e.materials[n].setExtension(ee,o);var s=r.extensions[ee];void 0!==s.ior&&o.setIOR(s.ior)}}),this},r.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var n=r.getExtension(ee);if(n){var o=e.materialIndexMap.get(r),s=t.json.materials[o];s.extensions=s.extensions||{},s.extensions[ee]={ior:n.getIOR()}}}),this},t}(e.Extension);te.EXTENSION_NAME=ee;var re=e.TextureChannel.R,ne=e.TextureChannel.G,oe=e.TextureChannel.B,se=e.TextureChannel.A,ie=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="PBRSpecularGlossiness",r.parentTypes=[e.PropertyType.MATERIAL],r.extensionName="KHR_materials_pbrSpecularGlossiness",r._diffuseFactor=[1,1,1,1],r._specularFactor=[1,1,1],r._glossinessFactor=1,r.diffuseTexture=null,r.diffuseTextureInfo=r.graph.link("diffuseTextureInfo",s(r),new e.TextureInfo(r.graph)),r.specularGlossinessTexture=null,r.specularGlossinessTextureInfo=r.graph.link("specularGlossinessTextureInfo",s(r),new e.TextureInfo(r.graph)),r}n(r,t);var o=r.prototype;return o.copy=function(r,n){return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this._diffuseFactor=r._diffuseFactor,this._specularFactor=r._specularFactor,this._glossinessFactor=r._glossinessFactor,this.setDiffuseTexture(r.diffuseTexture?n(r.diffuseTexture.getChild()):null),this.diffuseTextureInfo.getChild().copy(n(r.diffuseTextureInfo.getChild()),n),this.setSpecularGlossinessTexture(r.specularGlossinessTexture?n(r.specularGlossinessTexture.getChild()):null),this.specularGlossinessTextureInfo.getChild().copy(n(r.specularGlossinessTextureInfo.getChild()),n),this},o.dispose=function(){this.diffuseTextureInfo.getChild().dispose(),this.specularGlossinessTextureInfo.getChild().dispose(),t.prototype.dispose.call(this)},o.getDiffuseFactor=function(){return this._diffuseFactor},o.setDiffuseFactor=function(e){return this._diffuseFactor=e,this},o.getDiffuseHex=function(){return e.ColorUtils.factorToHex(this._diffuseFactor)},o.setDiffuseHex=function(t){return e.ColorUtils.hexToFactor(t,this._diffuseFactor),this},o.getDiffuseTexture=function(){return this.diffuseTexture?this.diffuseTexture.getChild():null},o.getDiffuseTextureInfo=function(){return this.diffuseTexture?this.diffuseTextureInfo.getChild():null},o.setDiffuseTexture=function(e){return this.diffuseTexture=this.graph.linkTexture("diffuseTexture",re|ne|oe|se,this,e),this},o.getSpecularFactor=function(){return this._specularFactor},o.setSpecularFactor=function(e){return this._specularFactor=e,this},o.getGlossinessFactor=function(){return this._glossinessFactor},o.setGlossinessFactor=function(e){return this._glossinessFactor=e,this},o.getSpecularGlossinessTexture=function(){return this.specularGlossinessTexture?this.specularGlossinessTexture.getChild():null},o.getSpecularGlossinessTextureInfo=function(){return this.specularGlossinessTexture?this.specularGlossinessTextureInfo.getChild():null},o.setSpecularGlossinessTexture=function(e){return this.specularGlossinessTexture=this.graph.linkTexture("specularGlossinessTexture",re|ne|oe|se,this,e),this},r}(e.ExtensionProperty);ie.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness",u([e.GraphChild],ie.prototype,"diffuseTexture",void 0),u([e.GraphChild],ie.prototype,"diffuseTextureInfo",void 0),u([e.GraphChild],ie.prototype,"specularGlossinessTexture",void 0),u([e.GraphChild],ie.prototype,"specularGlossinessTextureInfo",void 0);var ae="KHR_materials_pbrSpecularGlossiness",ue=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).extensionName=ae,t}n(t,e);var r=t.prototype;return r.createPBRSpecularGlossiness=function(){return new ie(this.doc.getGraph(),this)},r.read=function(e){var t=this,r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,o){if(r.extensions&&r.extensions[ae]){var s=t.createPBRSpecularGlossiness();e.materials[o].setExtension(ae,s);var i=r.extensions[ae];if(void 0!==i.diffuseFactor&&s.setDiffuseFactor(i.diffuseFactor),void 0!==i.specularFactor&&s.setSpecularFactor(i.specularFactor),void 0!==i.glossinessFactor&&s.setGlossinessFactor(i.glossinessFactor),void 0!==i.diffuseTexture){var a=i.diffuseTexture;s.setDiffuseTexture(e.textures[n[a.index].source]),e.setTextureInfo(s.getDiffuseTextureInfo(),a)}if(void 0!==i.specularGlossinessTexture){var u=i.specularGlossinessTexture;s.setSpecularGlossinessTexture(e.textures[n[u.index].source]),e.setTextureInfo(s.getSpecularGlossinessTextureInfo(),u)}}}),this},r.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var n=r.getExtension(ae);if(n){var o=e.materialIndexMap.get(r),s=t.json.materials[o];s.extensions=s.extensions||{};var i=s.extensions[ae]={diffuseFactor:n.getDiffuseFactor(),specularFactor:n.getSpecularFactor(),glossinessFactor:n.getGlossinessFactor()};if(n.getDiffuseTexture()){var a=n.getDiffuseTexture(),u=n.getDiffuseTextureInfo();i.diffuseTexture=e.createTextureInfoDef(a,u)}if(n.getSpecularGlossinessTexture()){var c=n.getSpecularGlossinessTexture(),l=n.getSpecularGlossinessTextureInfo();i.specularGlossinessTexture=e.createTextureInfoDef(c,l)}}}),this},t}(e.Extension);ue.EXTENSION_NAME=ae;var ce=e.TextureChannel.R,le=e.TextureChannel.G,he=e.TextureChannel.B,fe=e.TextureChannel.A,pe=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="Sheen",r.parentTypes=[e.PropertyType.MATERIAL],r.extensionName="KHR_materials_sheen",r._sheenColorFactor=[0,0,0],r._sheenRoughnessFactor=0,r.sheenColorTexture=null,r.sheenColorTextureInfo=r.graph.link("sheenColorTextureInfo",s(r),new e.TextureInfo(r.graph)),r.sheenRoughnessTexture=null,r.sheenRoughnessTextureInfo=r.graph.link("sheenRoughnessTextureInfo",s(r),new e.TextureInfo(r.graph)),r}n(r,t);var o=r.prototype;return o.copy=function(r,n){return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this._sheenColorFactor=r._sheenColorFactor,this._sheenRoughnessFactor=r._sheenRoughnessFactor,this.setSheenColorTexture(r.sheenColorTexture?n(r.sheenColorTexture.getChild()):null),this.sheenColorTextureInfo.getChild().copy(n(r.sheenColorTextureInfo.getChild()),n),this.setSheenRoughnessTexture(r.sheenRoughnessTexture?n(r.sheenRoughnessTexture.getChild()):null),this.sheenRoughnessTextureInfo.getChild().copy(n(r.sheenRoughnessTextureInfo.getChild()),n),this},o.dispose=function(){this.sheenColorTextureInfo.getChild().dispose(),this.sheenRoughnessTextureInfo.getChild().dispose(),t.prototype.dispose.call(this)},o.getSheenColorFactor=function(){return this._sheenColorFactor},o.getSheenColorHex=function(){return e.ColorUtils.factorToHex(this._sheenColorFactor)},o.setSheenColorFactor=function(e){return this._sheenColorFactor=e,this},o.setSheenColorHex=function(t){return e.ColorUtils.hexToFactor(t,this._sheenColorFactor),this},o.getSheenColorTexture=function(){return this.sheenColorTexture?this.sheenColorTexture.getChild():null},o.getSheenColorTextureInfo=function(){return this.sheenColorTexture?this.sheenColorTextureInfo.getChild():null},o.setSheenColorTexture=function(e){return this.sheenColorTexture=this.graph.linkTexture("sheenColorTexture",ce|le|he,this,e),this},o.getSheenRoughnessFactor=function(){return this._sheenRoughnessFactor},o.setSheenRoughnessFactor=function(e){return this._sheenRoughnessFactor=e,this},o.getSheenRoughnessTexture=function(){return this.sheenRoughnessTexture?this.sheenRoughnessTexture.getChild():null},o.getSheenRoughnessTextureInfo=function(){return this.sheenRoughnessTexture?this.sheenRoughnessTextureInfo.getChild():null},o.setSheenRoughnessTexture=function(e){return this.sheenRoughnessTexture=this.graph.linkTexture("sheenRoughnessTexture",fe,this,e),this},r}(e.ExtensionProperty);pe.EXTENSION_NAME="KHR_materials_sheen",u([e.GraphChild],pe.prototype,"sheenColorTexture",void 0),u([e.GraphChild],pe.prototype,"sheenColorTextureInfo",void 0),u([e.GraphChild],pe.prototype,"sheenRoughnessTexture",void 0),u([e.GraphChild],pe.prototype,"sheenRoughnessTextureInfo",void 0);var xe="KHR_materials_sheen",Te=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).extensionName=xe,t}n(t,e);var r=t.prototype;return r.createSheen=function(){return new pe(this.doc.getGraph(),this)},r.read=function(e){var t=this,r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,o){if(r.extensions&&r.extensions[xe]){var s=t.createSheen();e.materials[o].setExtension(xe,s);var i=r.extensions[xe];if(void 0!==i.sheenColorFactor&&s.setSheenColorFactor(i.sheenColorFactor),void 0!==i.sheenRoughnessFactor&&s.setSheenRoughnessFactor(i.sheenRoughnessFactor),void 0!==i.sheenColorTexture){var a=i.sheenColorTexture;s.setSheenColorTexture(e.textures[n[a.index].source]),e.setTextureInfo(s.getSheenColorTextureInfo(),a)}if(void 0!==i.sheenRoughnessTexture){var u=i.sheenRoughnessTexture;s.setSheenRoughnessTexture(e.textures[n[u.index].source]),e.setTextureInfo(s.getSheenRoughnessTextureInfo(),u)}}}),this},r.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var n=r.getExtension(xe);if(n){var o=e.materialIndexMap.get(r),s=t.json.materials[o];s.extensions=s.extensions||{};var i=s.extensions[xe]={sheenColorFactor:n.getSheenColorFactor(),sheenRoughnessFactor:n.getSheenRoughnessFactor()};if(n.getSheenColorTexture()){var a=n.getSheenColorTexture(),u=n.getSheenColorTextureInfo();i.sheenColorTexture=e.createTextureInfoDef(a,u)}if(n.getSheenRoughnessTexture()){var c=n.getSheenRoughnessTexture(),l=n.getSheenRoughnessTextureInfo();i.sheenRoughnessTexture=e.createTextureInfoDef(c,l)}}}),this},t}(e.Extension);Te.EXTENSION_NAME=xe;var de=e.TextureChannel.R,ge=e.TextureChannel.G,ve=e.TextureChannel.B,ye=e.TextureChannel.A,me=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="Specular",r.parentTypes=[e.PropertyType.MATERIAL],r.extensionName="KHR_materials_specular",r._specularFactor=1,r._specularColorFactor=[1,1,1],r.specularTexture=null,r.specularTextureInfo=r.graph.link("specularTextureInfo",s(r),new e.TextureInfo(r.graph)),r.specularColorTexture=null,r.specularColorTextureInfo=r.graph.link("specularColorTextureInfo",s(r),new e.TextureInfo(r.graph)),r}n(r,t);var o=r.prototype;return o.copy=function(r,n){return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this._specularFactor=r._specularFactor,this._specularColorFactor=r._specularColorFactor,this.setSpecularTexture(r.specularTexture?n(r.specularTexture.getChild()):null),this.specularTextureInfo.getChild().copy(n(r.specularTextureInfo.getChild()),n),this.setSpecularColorTexture(r.specularColorTexture?n(r.specularColorTexture.getChild()):null),this.specularColorTextureInfo.getChild().copy(n(r.specularColorTextureInfo.getChild()),n),this},o.dispose=function(){this.specularTextureInfo.getChild().dispose(),t.prototype.dispose.call(this)},o.getSpecularFactor=function(){return this._specularFactor},o.setSpecularFactor=function(e){return this._specularFactor=e,this},o.getSpecularColorFactor=function(){return this._specularColorFactor},o.setSpecularColorFactor=function(e){return this._specularColorFactor=e,this},o.getSpecularColorHex=function(){return e.ColorUtils.factorToHex(this._specularColorFactor)},o.setSpecularColorHex=function(t){return e.ColorUtils.hexToFactor(t,this._specularColorFactor),this},o.getSpecularTexture=function(){return this.specularTexture?this.specularTexture.getChild():null},o.getSpecularTextureInfo=function(){return this.specularTexture?this.specularTextureInfo.getChild():null},o.setSpecularTexture=function(e){return this.specularTexture=this.graph.linkTexture("specularTexture",ye,this,e),this},o.getSpecularColorTexture=function(){return this.specularColorTexture?this.specularColorTexture.getChild():null},o.getSpecularColorTextureInfo=function(){return this.specularColorTexture?this.specularColorTextureInfo.getChild():null},o.setSpecularColorTexture=function(e){return this.specularColorTexture=this.graph.linkTexture("specularColorTexture",de|ge|ve,this,e),this},r}(e.ExtensionProperty);me.EXTENSION_NAME="KHR_materials_specular",u([e.GraphChild],me.prototype,"specularTexture",void 0),u([e.GraphChild],me.prototype,"specularTextureInfo",void 0),u([e.GraphChild],me.prototype,"specularColorTexture",void 0),u([e.GraphChild],me.prototype,"specularColorTextureInfo",void 0);var Ee="KHR_materials_specular",Ce=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).extensionName=Ee,e}n(r,t);var o=r.prototype;return o.createSpecular=function(){return new me(this.doc.getGraph(),this)},o.read=function(e){var t=this,r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,o){if(r.extensions&&r.extensions[Ee]){var s=t.createSpecular();e.materials[o].setExtension(Ee,s);var i=r.extensions[Ee];if(void 0!==i.specularFactor&&s.setSpecularFactor(i.specularFactor),void 0!==i.specularColorFactor&&s.setSpecularColorFactor(i.specularColorFactor),void 0!==i.specularTexture){var a=i.specularTexture;s.setSpecularTexture(e.textures[n[a.index].source]),e.setTextureInfo(s.getSpecularTextureInfo(),a)}if(void 0!==i.specularColorTexture){var u=i.specularColorTexture;s.setSpecularColorTexture(e.textures[n[u.index].source]),e.setTextureInfo(s.getSpecularColorTextureInfo(),u)}}}),this},o.write=function(t){var r=t.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(n){var o=n.getExtension(Ee);if(o){var s=t.materialIndexMap.get(n),i=r.json.materials[s];i.extensions=i.extensions||{};var a=i.extensions[Ee]={};if(1!==o.getSpecularFactor()&&(a.specularFactor=o.getSpecularFactor()),e.MathUtils.eq(o.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=o.getSpecularColorFactor()),o.getSpecularTexture()){var u=o.getSpecularTexture(),c=o.getSpecularTextureInfo();a.specularTexture=t.createTextureInfoDef(u,c)}if(o.getSpecularColorTexture()){var l=o.getSpecularColorTexture(),h=o.getSpecularColorTextureInfo();a.specularColorTexture=t.createTextureInfoDef(l,h)}}}),this},r}(e.Extension);Ce.EXTENSION_NAME=Ee;var _e=e.TextureChannel.R,Ie=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="Transmission",r.parentTypes=[e.PropertyType.MATERIAL],r.extensionName="KHR_materials_transmission",r._transmissionFactor=0,r.transmissionTexture=null,r.transmissionTextureInfo=r.graph.link("transmissionTextureInfo",s(r),new e.TextureInfo(r.graph)),r}n(r,t);var o=r.prototype;return o.copy=function(r,n){return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this._transmissionFactor=r._transmissionFactor,this.setTransmissionTexture(r.transmissionTexture?n(r.transmissionTexture.getChild()):null),this.transmissionTextureInfo.getChild().copy(n(r.transmissionTextureInfo.getChild()),n),this},o.dispose=function(){this.transmissionTextureInfo.getChild().dispose(),t.prototype.dispose.call(this)},o.getTransmissionFactor=function(){return this._transmissionFactor},o.setTransmissionFactor=function(e){return this._transmissionFactor=e,this},o.getTransmissionTexture=function(){return this.transmissionTexture?this.transmissionTexture.getChild():null},o.getTransmissionTextureInfo=function(){return this.transmissionTexture?this.transmissionTextureInfo.getChild():null},o.setTransmissionTexture=function(e){return this.transmissionTexture=this.graph.linkTexture("transmissionTexture",_e,this,e),this},r}(e.ExtensionProperty);Ie.EXTENSION_NAME="KHR_materials_transmission",u([e.GraphChild],Ie.prototype,"transmissionTexture",void 0),u([e.GraphChild],Ie.prototype,"transmissionTextureInfo",void 0);var Ne="KHR_materials_transmission",Ae=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).extensionName=Ne,t}n(t,e);var r=t.prototype;return r.createTransmission=function(){return new Ie(this.doc.getGraph(),this)},r.read=function(e){var t=this,r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,o){if(r.extensions&&r.extensions[Ne]){var s=t.createTransmission();e.materials[o].setExtension(Ne,s);var i=r.extensions[Ne];if(void 0!==i.transmissionFactor&&s.setTransmissionFactor(i.transmissionFactor),void 0!==i.transmissionTexture){var a=i.transmissionTexture;s.setTransmissionTexture(e.textures[n[a.index].source]),e.setTextureInfo(s.getTransmissionTextureInfo(),a)}}}),this},r.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var n=r.getExtension(Ne);if(n){var o=e.materialIndexMap.get(r),s=t.json.materials[o];s.extensions=s.extensions||{};var i=s.extensions[Ne]={transmissionFactor:n.getTransmissionFactor()};if(n.getTransmissionTexture()){var a=n.getTransmissionTexture(),u=n.getTransmissionTextureInfo();i.transmissionTexture=e.createTextureInfoDef(a,u)}}}),this},t}(e.Extension);Ae.EXTENSION_NAME=Ne;var Re=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="Unlit",r.parentTypes=[e.PropertyType.MATERIAL],r.extensionName="KHR_materials_unlit",r}return n(r,t),r}(e.ExtensionProperty);Re.EXTENSION_NAME="KHR_materials_unlit";var Se="KHR_materials_unlit",we=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).extensionName=Se,t}n(t,e);var r=t.prototype;return r.createUnlit=function(){return new Re(this.doc.getGraph(),this)},r.read=function(e){var t=this;return(e.jsonDoc.json.materials||[]).forEach(function(r,n){r.extensions&&r.extensions[Se]&&e.materials[n].setExtension(Se,t.createUnlit())}),this},r.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){if(r.getExtension(Se)){var n=e.materialIndexMap.get(r),o=t.json.materials[n];o.extensions=o.extensions||{},o.extensions[Se]={}}}),this},t}(e.Extension);we.EXTENSION_NAME=Se;var Me=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).propertyType="Mapping",e.parentTypes=["MappingList"],e.extensionName="KHR_materials_variants",e.material=null,e.variants=[],e}n(r,t);var o=r.prototype;return o.copy=function(r,n){var o=this;return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this.setMaterial(r.material?n(r.material.getChild()):null),this.clearGraphChildList(this.variants),r.variants.forEach(function(e){return o.addVariant(n(e.getChild()))}),this},o.getMaterial=function(){return this.material?this.material.getChild():null},o.setMaterial=function(e){return this.material=this.graph.link("material",this,e),this},o.addVariant=function(e){var t=this.graph.link("variant",this,e);return this.addGraphChild(this.variants,t)},o.removeVariant=function(e){return this.removeGraphChild(this.variants,e)},o.listVariants=function(){return this.variants.map(function(e){return e.getChild()})},r}(e.ExtensionProperty);Me.EXTENSION_NAME="KHR_materials_variants",u([e.GraphChild],Me.prototype,"material",void 0),u([e.GraphChildList],Me.prototype,"variants",void 0);var Oe=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="MappingList",r.parentTypes=[e.PropertyType.PRIMITIVE],r.extensionName="KHR_materials_variants",r.mappings=[],r}n(r,t);var o=r.prototype;return o.copy=function(r,n){var o=this;return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this.clearGraphChildList(this.mappings),r.mappings.forEach(function(e){return o.addMapping(n(e.getChild()))}),this},o.addMapping=function(e){var t=this.graph.link("mapping",this,e);return this.addGraphChild(this.mappings,t)},o.removeMapping=function(e){return this.removeGraphChild(this.mappings,e)},o.listMappings=function(){return this.mappings.map(function(e){return e.getChild()})},r}(e.ExtensionProperty);Oe.EXTENSION_NAME="KHR_materials_variants",u([e.GraphChildList],Oe.prototype,"mappings",void 0);var Fe=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="Variant",r.parentTypes=[e.PropertyType.ROOT,"MappingList"],r.extensionName="KHR_materials_variants",r}return n(r,t),r}(e.ExtensionProperty);Fe.EXTENSION_NAME="KHR_materials_variants";var De="KHR_materials_variants",be=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).extensionName=De,t}n(t,e);var r=t.prototype;return r.createMappingList=function(){return new Oe(this.doc.getGraph(),this)},r.createVariant=function(e){return void 0===e&&(e=""),new Fe(this.doc.getGraph(),this).setName(e)},r.createMapping=function(){return new Me(this.doc.getGraph(),this)},r.listVariants=function(){return Array.from(this.properties).filter(function(e){return e instanceof Fe})},r.read=function(e){var t=this,r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[De])return this;var n=(r.json.extensions[De].variants||[]).map(function(e){return t.createVariant().setName(e.name||"")});return(r.json.meshes||[]).forEach(function(r,o){var s=e.meshes[o];(r.primitives||[]).forEach(function(r,o){if(r.extensions&&r.extensions[De]){for(var i,u=t.createMappingList(),c=a(r.extensions[De].mappings);!(i=c()).done;){var l=i.value,h=t.createMapping();void 0!==l.material&&h.setMaterial(e.materials[l.material]);for(var f,p=a(l.variants||[]);!(f=p()).done;)h.addVariant(n[f.value]);u.addMapping(h)}s.listPrimitives()[o].setExtension(De,u)}})}),this},r.write=function(e){var t=e.jsonDoc,r=this.listVariants();if(!r.length)return this;for(var n,o=[],s=new Map,i=a(r);!(n=i()).done;){var u=n.value;s.set(u,o.length),o.push(e.createPropertyDef(u))}for(var c,l=function(){var t=c.value,r=e.meshIndexMap.get(t);t.listPrimitives().forEach(function(t,n){var o=t.getExtension(De);if(o){var i=e.jsonDoc.json.meshes[r].primitives[n],a=o.listMappings().map(function(t){var r=e.createPropertyDef(t),n=t.getMaterial();return n&&(r.material=e.materialIndexMap.get(n)),r.variants=t.listVariants().map(function(e){return s.get(e)}),r});i.extensions=i.extensions||{},i.extensions[De]={mappings:a}}})},h=a(this.doc.getRoot().listMeshes());!(c=h()).done;)l();return t.json.extensions=t.json.extensions||{},t.json.extensions[De]={variants:o},this},t}(e.Extension);be.EXTENSION_NAME=De;var Ge=e.TextureChannel.G,Pe=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="Transmission",r.parentTypes=[e.PropertyType.MATERIAL],r.extensionName="KHR_materials_volume",r._thicknessFactor=0,r._attenuationDistance=Infinity,r._attenuationColor=[1,1,1],r.thicknessTexture=null,r.thicknessTextureInfo=r.graph.link("thicknessTextureInfo",s(r),new e.TextureInfo(r.graph)),r}n(r,t);var o=r.prototype;return o.copy=function(r,n){return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this._thicknessFactor=r._thicknessFactor,this._attenuationDistance=r._attenuationDistance,this._attenuationColor=[].concat(r._attenuationColor),this.setThicknessTexture(r.thicknessTexture?n(r.thicknessTexture.getChild()):null),this.thicknessTextureInfo.getChild().copy(n(r.thicknessTextureInfo.getChild()),n),this},o.dispose=function(){this.thicknessTextureInfo.getChild().dispose(),t.prototype.dispose.call(this)},o.getThicknessFactor=function(){return this._thicknessFactor},o.setThicknessFactor=function(e){return this._thicknessFactor=e,this},o.getThicknessTexture=function(){return this.thicknessTexture?this.thicknessTexture.getChild():null},o.getThicknessTextureInfo=function(){return this.thicknessTexture?this.thicknessTextureInfo.getChild():null},o.setThicknessTexture=function(e){return this.thicknessTexture=this.graph.linkTexture("thicknessTexture",Ge,this,e),this},o.getAttenuationDistance=function(){return this._attenuationDistance},o.setAttenuationDistance=function(e){return this._attenuationDistance=e,this},o.getAttenuationColor=function(){return this._attenuationColor},o.setAttenuationColor=function(e){return this._attenuationColor=e,this},o.getAttenuationColorHex=function(){return e.ColorUtils.factorToHex(this._attenuationColor)},o.setAttenuationColorHex=function(t){return e.ColorUtils.hexToFactor(t,this._attenuationColor),this},r}(e.ExtensionProperty);Pe.EXTENSION_NAME="KHR_materials_volume",u([e.GraphChild],Pe.prototype,"thicknessTexture",void 0),u([e.GraphChild],Pe.prototype,"thicknessTextureInfo",void 0);var Be="KHR_materials_volume",Ue=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).extensionName=Be,e}n(r,t);var o=r.prototype;return o.createVolume=function(){return new Pe(this.doc.getGraph(),this)},o.read=function(e){var t=this,r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,o){if(r.extensions&&r.extensions[Be]){var s=t.createVolume();e.materials[o].setExtension(Be,s);var i=r.extensions[Be];if(void 0!==i.thicknessFactor&&s.setThicknessFactor(i.thicknessFactor),void 0!==i.attenuationDistance&&s.setAttenuationDistance(i.attenuationDistance),void 0!==i.attenuationColor&&s.setAttenuationColor(i.attenuationColor),void 0!==i.thicknessTexture){var a=i.thicknessTexture;s.setThicknessTexture(e.textures[n[a.index].source]),e.setTextureInfo(s.getThicknessTextureInfo(),a)}}}),this},o.write=function(t){var r=t.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(n){var o=n.getExtension(Be);if(o){var s=t.materialIndexMap.get(n),i=r.json.materials[s];i.extensions=i.extensions||{};var a=i.extensions[Be]={};if(o.getThicknessFactor()>0&&(a.thicknessFactor=o.getThicknessFactor()),Number.isFinite(o.getAttenuationDistance())&&(a.attenuationDistance=o.getAttenuationDistance()),e.MathUtils.eq(o.getAttenuationColor(),[1,1,1])||(a.attenuationColor=o.getAttenuationColor()),o.getThicknessTexture()){var u=o.getThicknessTexture(),c=o.getThicknessTextureInfo();a.thicknessTexture=t.createTextureInfoDef(u,c)}}}),this},r}(e.Extension);Ue.EXTENSION_NAME=Be;var je="KHR_mesh_quantization",Le=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).extensionName=je,t}n(t,e);var r=t.prototype;return r.read=function(e){return this},r.write=function(e){return this},t}(e.Extension);Le.EXTENSION_NAME=je;var ke="KHR_texture_basisu",He=function(){function e(){}var r=e.prototype;return r.getSize=function(e){var r=t.read(new Uint8Array(e));return[r.pixelWidth,r.pixelHeight]},r.getChannels=function(e){var r=t.read(new Uint8Array(e)).dataFormatDescriptor[0];if(r.colorModel===t.KTX2Model.ETC1S)return 2===r.samples.length&&15==(15&r.samples[1].channelID)?4:3;if(r.colorModel===t.KTX2Model.UASTC)return 3==(15&r.samples[0].channelID)?4:3;throw new Error('Unexpected KTX2 colorModel, "'+r.colorModel+'".')},r.getGPUByteLength=function(e){for(var r=t.read(new Uint8Array(e)),n=this.getChannels(e)>3,o=0,s=0;s<r.levels.length;s++){var i=r.levels[s];o+=i.uncompressedByteLength?i.uncompressedByteLength:Math.max(1,Math.floor(r.pixelWidth/Math.pow(2,s)))/4*(Math.max(1,Math.floor(r.pixelHeight/Math.pow(2,s)))/4)*(n?16:8)}return o},e}(),Ve=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).extensionName=ke,r.prereadTypes=[e.PropertyType.TEXTURE],r}n(r,t),r.register=function(){e.ImageUtils.registerFormat("image/ktx2",new He)};var o=r.prototype;return o.preread=function(e){return e.jsonDoc.json.textures.forEach(function(e){e.extensions&&e.extensions[ke]&&(e.source=e.extensions[ke].source)}),this},o.read=function(e){return this},o.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listTextures().forEach(function(r){if("image/ktx2"===r.getMimeType()){var n=e.imageIndexMap.get(r);t.json.textures.forEach(function(e){e.source===n&&(e.extensions=e.extensions||{},e.extensions[ke]={source:e.source},delete e.source)})}}),this},r}(e.Extension);Ve.EXTENSION_NAME=ke;var Xe=function(t){function r(){for(var r,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return(r=t.call.apply(t,[this].concat(o))||this).propertyType="Transform",r.parentTypes=[e.PropertyType.TEXTURE_INFO],r.extensionName="KHR_texture_transform",r._offset=[0,0],r._rotation=0,r._scale=[1,1],r._texCoord=null,r}n(r,t);var o=r.prototype;return o.copy=function(r,n){return void 0===n&&(n=e.COPY_IDENTITY),t.prototype.copy.call(this,r,n),this._offset=r._offset,this._rotation=r._rotation,this._scale=r._scale,this._texCoord=r._texCoord,this},o.getOffset=function(){return this._offset},o.setOffset=function(e){return this._offset=e,this},o.getRotation=function(){return this._rotation},o.setRotation=function(e){return this._rotation=e,this},o.getScale=function(){return this._scale},o.setScale=function(e){return this._scale=e,this},o.getTexCoord=function(){return this._texCoord},o.setTexCoord=function(e){return this._texCoord=e,this},r}(e.ExtensionProperty);Xe.EXTENSION_NAME="KHR_texture_transform";var Ke="KHR_texture_transform",Ye=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).extensionName=Ke,e}n(r,t);var o=r.prototype;return o.createTransform=function(){return new Xe(this.doc.getGraph(),this)},o.read=function(e){for(var t=0,r=Array.from(e.textureInfos.entries());t<r.length;t++){var n=r[t],o=n[0],s=n[1];if(s.extensions&&s.extensions[Ke]){var i=this.createTransform(),a=s.extensions[Ke];void 0!==a.offset&&i.setOffset(a.offset),void 0!==a.rotation&&i.setRotation(a.rotation),void 0!==a.scale&&i.setScale(a.scale),void 0!==a.texCoord&&i.setTexCoord(a.texCoord),o.setExtension(Ke,i)}}return this},o.write=function(t){for(var r=0,n=Array.from(t.textureInfoDefMap.entries());r<n.length;r++){var o=n[r],s=o[1],i=o[0].getExtension(Ke);if(i){s.extensions=s.extensions||{};var a={},u=e.MathUtils.eq;u(i.getOffset(),[0,0])||(a.offset=i.getOffset()),0!==i.getRotation()&&(a.rotation=i.getRotation()),u(i.getScale(),[1,1])||(a.scale=i.getScale()),null!=i.getTexCoord()&&(a.texCoord=i.getTexCoord()),s.extensions[Ke]=a}}return this},r}(e.Extension);Ye.EXTENSION_NAME=Ke;var qe=[H,Y,Z,te,ue,Ce,Te,Ae,we,be,Ue,Le,Ve,Ye],ze=[x,E,I].concat(qe);exports.ALL_EXTENSIONS=ze,exports.Clearcoat=W,exports.DracoMeshCompression=H,exports.IOR=$,exports.InstancedMesh=c,exports.KHRONOS_EXTENSIONS=qe,exports.Light=X,exports.LightsPunctual=Y,exports.Mapping=Me,exports.MappingList=Oe,exports.MaterialsClearcoat=Z,exports.MaterialsIOR=te,exports.MaterialsPBRSpecularGlossiness=ue,exports.MaterialsSheen=Te,exports.MaterialsSpecular=Ce,exports.MaterialsTransmission=Ae,exports.MaterialsUnlit=we,exports.MaterialsVariants=be,exports.MaterialsVolume=Ue,exports.MeshGPUInstancing=x,exports.MeshQuantization=Le,exports.MeshoptCompression=E,exports.PBRSpecularGlossiness=ie,exports.Sheen=pe,exports.Specular=me,exports.TextureBasisu=Ve,exports.TextureTransform=Ye,exports.TextureWebP=I,exports.Transform=Xe,exports.Transmission=Ie,exports.Unlit=Re,exports.Variant=Fe,exports.Volume=Pe;
//# sourceMappingURL=extensions.js.map
